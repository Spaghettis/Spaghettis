#N canvas 237 101 944 712 12;
#N canvas 195 311 647 354 delay-writer 0;
#X obj 86 220 inlet~;
#X obj 86 326 outlet~;
#X obj 392 197 block~ 1;
#X obj 164 267 *~ 0.99;
#X obj 87 272 +~;
#X obj 165 221 inlet;
#X text 80 7 Because of the feedback \, the delwrite~ has to be computed after the delread~. So we set the blocksize to 1 to minimize the resulting delay.;
#X text 390 219 this object sets the;
#X text 389 236 block size for audio;
#X text 388 255 computations in this;
#X obj 165 244 delread~ G04-del;
#X obj 98 302 delwrite~ G04-del 1000;
#X text 79 183 incoming;
#X text 81 198 pulses;
#X text 165 182 delay;
#X text 166 197 time;
#X text 388 273 window. Must be a;
#X text 388 292 power of two.;
#X text 77 60 The smaller the blocksize the more expensive the computations are \, so don't reduce it lower than you have to. Also \, it's a good idea to isolate the portion of the patch that requires the smaller block size \, and only run that portion that way. Here \, the pulses that excite the delay line are computed outside this window \, and the output level control as well.;
#X connect 0 0 4 0;
#X connect 3 0 4 1;
#X connect 4 0 1 0;
#X connect 4 0 11 0;
#X connect 5 0 10 0;
#X connect 10 0 3 0;
#X coords 0 0 1 1 250 175 0 0 0;
#X restore 192 528 pd delay-writer;
#X obj 324 492 expr 1000/$f1;
#X obj 324 468 mtof;
#X msg 192 468 1;
#X msg 228 468 0;
#X obj 192 360 metro 500;
#X obj 324 408 random 60;
#X obj 192 336 loadbang;
#X obj 324 444 + 30;
#X text 120 120 CONTROLLING DELAY WITH BLOCK~;
#X text 336 528 <-- here is the delay loop;
#X text 96 156 In situations where a delay read feeds back to a delay write \, the minimum possible delay you can achieve is one block \, which by default is 64 samples \, or 1.45 msec at 44100 Hz. You can shorten the minimum delay by changing the block size. Do this in a subpatch (open it to see how).;
#X obj 192 552 output~;
#X obj 192 492 vline~;
#X text 96 228 Here we use this principle to make a harpisichord-like sound by sending pulses into a recirculating delay line (which imitates the travel of the wave up and down the harpsichord string.) This is related to Karplus-Strong synthesis \, but the idea is probably much older than their paper.;
#X text 72 432 this makes;
#X text 72 456 a rectangular;
#X text 72 492 long.;
#X text 444 480 length of delay line is;
#X text 444 492 1000/(frequency);
#X obj 228 432 del 1;
#X text 72 468 pulse 1 msec;
#X obj 12 12 cnv 15 250 45 empty empty empty 0 -7 0 10 #cccccc #000000;
#X obj -60 12 freeze;
#X text 24 24 delay (blocksize);
#X connect 0 0 12 0;
#X connect 1 0 0 1;
#X connect 2 0 1 0;
#X connect 3 0 13 0;
#X connect 4 0 13 0;
#X connect 5 0 3 0;
#X connect 5 0 6 0;
#X connect 5 0 20 0;
#X connect 6 0 8 0;
#X connect 7 0 5 0;
#X connect 8 0 2 0;
#X connect 13 0 0 0;
#X connect 20 0 4 0;
#X coords 0 0 1 1 250 175 0 0 0;
