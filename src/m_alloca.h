
/* 
    Copyright (c) 1997-2015 Miller Puckette and others.
*/

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#pragma mark -

#ifndef __m_alloca_h_
#define __m_alloca_h_

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#pragma mark -

#ifndef PD_WITH_ALLOCA
#define PD_WITH_ALLOCA 1        /* Message passing use alloca function. */
#endif
   
// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#pragma mark -

#include <alloca.h>

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#pragma mark -

#if PD_WITH_ALLOCA

    #define ATOMS_ALLOCA(x, n)  \
        (x) = (t_atom *)((n) < 100 ? alloca ((n) * sizeof (t_atom)) : getbytes ((n) * sizeof (t_atom)))
        
    #define ATOMS_FREEA(x, n)   \
        if (n >= 100) { freebytes ((x), (n) * sizeof (t_atom)); }
    
#else

    #define ATOMS_ALLOCA(x, n)  \
        (x) = (t_atom *)getbytes ((n) * sizeof (t_atom))
        
    #define ATOMS_FREEA(x, n)   \
        freebytes ((x), (n) * sizeof (t_atom))

#endif // PD_WITH_ALLOCA

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#endif // __m_alloca_h_
