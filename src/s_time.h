
/* Copyright (c) 1997-2017 Miller Puckette and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#ifndef __s_time_h_
#define __s_time_h_

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

typedef uint64_t t_time;
typedef uint64_t t_nano;
typedef uint64_t t_stamp;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#define PD_ZERO_TIME    0ULL
#define PD_ZERO_NANO    0ULL
#define PD_ZERO_STAMP   0ULL

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

typedef struct _timebase {
    t_time          time_;
    struct timeval  tv_;
    } t_timebase;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

uint64_t    time_makeRandomSeed         (void);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

/* Do NOT call time_addNanoseconds or time_elapsedNanoseconds at initialization time. */

/* < http://www.parashift.com/c++-faq/static-init-order.html > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void        time_set                    (t_time *t);
void        time_addNanoseconds         (t_time *t, const t_nano *ns);
t_error     time_elapsedNanoseconds     (const t_time *t0, const t_time *t1, t_nano *r);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void        pizNanoSleep            (t_nano *ns);
void        pizNanoWithDouble       (t_nano *ns, double f);
uint64_t    pizNanoAsUInt64         (t_nano *ns);
int         pizNanoIsLessThan       (t_nano *t1, t_nano *t2);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

/* < https://en.wikipedia.org/wiki/Network_Time_Protocol > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void        pizStampSet             (t_stamp *stamp);
void        pizStampCopy            (t_stamp *stamp, const t_stamp *toCopy);
void        pizStampAddNano         (t_stamp *stamp, const t_nano *ns);
t_error     pizStampElapsedNano     (const t_stamp *t0, const t_stamp *t1, t_nano *r);
uint64_t    pizStampAsUInt64        (t_stamp *stamp);
void        pizStampWithUInt64      (t_stamp *stamp, uint64_t n);
int         pizStampIsEqual         (t_stamp *t1, t_stamp *t2);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

t_error     pizBaseInit             (t_timebase *base);
t_error     pizBaseTimeToStamp      (const t_timebase *base, const t_time *t, t_stamp *stamp);
t_error     pizBaseStampToTime      (const t_timebase *base, const t_stamp *stamp, t_time *t);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#endif // __s_time_h_

