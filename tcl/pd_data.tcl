
# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

# Copyright (c) 1997-2015 Miller Puckette and others ( https://opensource.org/licenses/BSD-3-Clause ).

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

# Scalar properties.

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

package provide pd_data 0.1

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

namespace eval ::pd_data:: {

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

proc show {top content} {

    ::pd_data::_create $top $content
}

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

proc _create {top content} {

    toplevel $top -class PdText
    wm title $top [_ "Data"]
    wm group $top .
    
    wm minsize  $top 50 50
    wm geometry $top [format "=600x400%s" [::rightNextTo $::var(windowFocused)]]

    text $top.text  -font [::getFont 14] \
                    -borderwidth 0 \
                    -highlightthickness 0
    
    pack $top.text  -side left -fill both -expand 1

    $top.text insert end $content
    
    wm protocol $top WM_DELETE_WINDOW   "::pd_data::_closed $top"
        
    focus $top.text
}

proc _closed {top} {

    ::pd_data::_apply  $top
    ::pd_data::_cancel $top
}

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

proc _apply {top} {

}

proc _cancel {top} {

    ::pd_connect::pdsend "$top cancel"
}

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

proc send {top} {
    for {set i 1} {[$top.text compare [concat $i.0 + 3 chars] < end]} \
        {incr i 1} {
            ::pd_connect::pdsend "$top data [$top.text get $i.0 [expr $i + 1].0]"
        }
    ::pd_connect::pdsend "$top end"
}

proc ok {top} {
    ::pd_data::send $top
    ::pd_data::_cancel $top
}

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

}

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------
