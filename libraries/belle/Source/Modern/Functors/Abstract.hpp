
/* 
    Copyright (c) 2007-2013 William Andrew Burnson.
    Copyright (c) 2013-2018 Nicolas Danet.
    
*/

/* < http://opensource.org/licenses/BSD-2-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#ifndef BELLE_MODERN_FUNCTORS_ABSTRACT_HPP
#define BELLE_MODERN_FUNCTORS_ABSTRACT_HPP

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

/* Engrave a stamp according to a token. */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace belle { 

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

class Music;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

class Engraver {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

public:
    Engraver() : selected_ (false)
    {
    }
    
    virtual ~Engraver()
    {
    }

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#if PRIM_CPP11

protected:
    Engraver (const Engraver&) = default;
    Engraver (Engraver&&) = default;
    Engraver& operator = (const Engraver&) = default;
    Engraver& operator = (Engraver&&) = default;

#else

protected:
    Engraver (const Engraver& o) : selected_ (o.selected_)
    {
    }
    
    Engraver& operator = (const Engraver& o)
    {
        selected_ = o.selected_; return *this;
    }

#endif

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

public:
    bool isSelected()
    {
        return selected_;
    }
    
    Engraver& setSelected (bool selected)
    {
        selected_ = selected; return *this;
    }
    
// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

public:
    virtual Pointer < Engraver > clone() const = 0;

public:
    virtual void engrave (Music& music, NodePtr token, const Pointer < Stamp > & stamp) = 0;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

private:
    bool selected_;
    
private:
    PRIM_LEAK_DETECTOR (Engraver)
};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

/* Do something while traversing the music graph. */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

class Music;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

struct Typesetter {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

class Partwise {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

public:
    Partwise()
    {
    }
    
    virtual ~Partwise()
    {
    }

#if PRIM_CPP11

public:
    Partwise (const Partwise&) = default;
    Partwise (Partwise&&) = default;
    Partwise& operator = (const Partwise&) = default;
    Partwise& operator = (Partwise&&) = default;

#endif

public:
    virtual void start (Music&) const = 0;
    virtual void end (Music&) const = 0;
    virtual void endPart (Music&) const = 0;
    
public:
    virtual void perform (Music& music, NodePtr island) const = 0;

private:
    PRIM_LEAK_DETECTOR (Partwise)
};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

class Instantwise {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

public:
    Instantwise()
    {
    }
    
    virtual ~Instantwise()
    {
    }

#if PRIM_CPP11

public:
    Instantwise (const Instantwise&) = default;
    Instantwise (Instantwise&&) = default;
    Instantwise& operator = (const Instantwise&) = default;
    Instantwise& operator = (Instantwise&&) = default;

#endif

public:
    virtual void start (Music&) const = 0;
    virtual void end (Music&) const = 0;
    virtual void endInstant (Music&) const = 0;
    
public:
    virtual void perform (Music& music, NodePtr island) const = 0;

private:
    PRIM_LEAK_DETECTOR (Instantwise)
};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace belle

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#endif // BELLE_MODERN_FUNCTORS_ABSTRACT_HPP
